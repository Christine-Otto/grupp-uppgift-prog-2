<!-- ============================================================
Fil: results.html
Templatemall – Visar sökresultat, författarinformation och statistik.
============================================================ -->

<!-- Denna sida renderas av Flask efter att användaren gjort en sökning.
     Flask skickar med:
       - query: söksträngen
       - author_info: biografi från Wikipedia
       - results: bokdata från Gutendex
       - chart_html: färdig HTML för diagrammet från viz.py
-->

<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Sökresultat</title>

    <!-- Enkel CSS för tydlig tabell och layout -->
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        img { max-width: 150px; border-radius: 8px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        h2 { margin-top: 40px; }
        .chart { margin-top: 40px; }
    </style>
</head>

<body>
    <!-- Huvudrubrik: visar vad användaren sökte efter -->
    <h1>Resultat för: {{ query }}</h1>

    <!-- =========================================================
         FÖRFATTARINFORMATION
         Hämtas från Wikipedia via get_bio()
    ========================================================== -->
    {% if author_info %}
        <div class="author-section">
            <h2>{{ author_info.title }}</h2>

            <!-- Författarbild visas om en thumbnail finns -->
            {% if author_info.image %}
                <img src="{{ author_info.image }}" alt="Bild på {{ author_info.title }}">
            {% endif %}

            <!-- Kort sammanfattning (extract) -->
            <p>{{ author_info.summary }}</p>

            <!-- Länk till Wikipedia-artikel (öppnas i ny flik) -->
            {% if author_info.url %}
                <p><a href="{{ author_info.url }}" target="_blank">Läs mer på Wikipedia</a></p>
            {% endif %}
        </div>
    {% endif %}

    <!-- =========================================================
         TABELL MED BÖCKER
         Data hämtad från Gutendex (get_books → results)
    ========================================================== -->
    {% if results %}
        <h2>Böcker</h2>
        <table>
            <tr>
                <th>Titel</th>
                <th>Författare</th>
                <th>Språk</th>
                <th>Nedladdningar</th>
                <th>Länk</th>
            </tr>

            <!-- Loopa igenom alla böcker i resultatet -->
            {% for book in results %}
                <tr>
                    <td>{{ book.title | default('Okänd titel') }}</td>
                    <td>{{ book.authors | map(attribute='name') | join(', ') }}</td>
                    <td>{% if book.languages is iterable and book.languages %}{{ book.languages | join(', ') }}{% else %}{{ book.languages }}{% endif %}</td>
                    <td>{{ book.download_count | default(0) }}</td>

                    <!-- Försök hitta en läsbar länk från formats (föredra HTML, sedan plain, annars första) -->
                    <td>
                        {%- set link = None -%}
                        {%- if book.formats is defined -%}
                            {%- if book.formats.get('text/html') -%}
                                {%- set link = book.formats.get('text/html') -%}
                            {%- elif book.formats.get('text/plain') -%}
                                {%- set link = book.formats.get('text/plain') -%}
                            {%- else -%}
                                {%- set _vals = book.formats.values() | list -%}
                                {%- if _vals | length > 0 -%}
                                    {%- set link = _vals[0] -%}
                                {%- endif -%}
                            {%- endif -%}
                        {%- endif -%}

                        {% if link %}
                            <a href="{{ link }}" target="_blank">Läs</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% else %}
        <!-- Om inga böcker hittas -->
        <p>Inga böcker hittades.</p>
    {% endif %}

    <!-- =========================================================
         DIAGRAM
         HTML inbäddas direkt från viz.py via {{ chart_html|safe }}
    ========================================================== -->
    <div class="chart">
        {{ chart_html|safe }}
    </div>

    <!-- Länk tillbaka till startsidan -->
    <p><a href="/">Ny sökning</a></p>
</body>
</html>


<!-- ------------------------------------------------------------
FÖRKLARING
-------------------------------------------------------------
- {{ author_info }}  → biografi från Wikipedia-service.
- {{ results }}      → bokdata från Gutendex (lista av dicts).
- {{ chart_html|safe }} → HTML från Plotly som visas direkt.
- Loopen (for book in results) går igenom varje bokpost.
- Länken längst ner tar användaren tillbaka till index.html.
------------------------------------------------------------- -->